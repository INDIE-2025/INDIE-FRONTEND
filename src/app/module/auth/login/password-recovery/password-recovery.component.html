<div class="recovery-container">
  <div class="background-brand">
    <h1 class="brand-title">INDIE</h1>
    <p class="brand-subtitle">La plataforma definitiva para descubrir la mejor escena independiente</p>
  </div>
  
  <div class="main-content">
    <div class="form-container">
      @if (!isEmailSent) {
        <div class="recovery-form">
          <div class="form-header">
            <h2>Recuperar Contraseña</h2>
            <p>Ingresa tu email y te enviaremos un enlace para recuperar tu contraseña</p>
          </div>

          <form [formGroup]="recoveryForm" (ngSubmit)="onSubmit()">
            <div class="form-group">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Email</mat-label>
                <mat-icon matPrefix class="icon">email</mat-icon>
                <input matInput 
                       type="email" 
                       formControlName="email" 
                       placeholder="Ingresa tu email registrado"
                       autocomplete="email">
               @if(recoveryForm.get('email')?.invalid && recoveryForm.get('email')?.touched){ <mat-error>
                  {{ getErrorMessage('email') }}
                </mat-error>}
              </mat-form-field>
            </div>

            <button 
              type="submit" 
              [disabled]="!recoveryForm.valid || isLoading" 
              class="submit-btn"
              mat-raised-button
              color="primary"
            >
              @if (isLoading) {
                <span>Enviando...</span>
              } @else {
                <span>Enviar enlace de recuperación</span>
              }
            </button>

            <div class="form-footer">
              <p>¿Recordaste tu contraseña? <a routerLink="/login" class="link">Inicia sesión</a></p>
            </div>
          </form>
        </div>
      }

      <!-- Mensaje de confirmación después de enviar el email -->
      @if (isEmailSent) {
        <div class="email-sent-message">
          <div class="success-icon">
            <mat-icon>mark_email_read</mat-icon>
          </div>
          <h2>¡Email enviado!</h2>
          <p>Te hemos enviado un enlace de recuperación a tu email.</p>
          <p>Por favor, revisa tu bandeja de entrada y sigue las instrucciones.</p>
          
          @if (countdown > 0) {
            <div class="resend-section">
              <p>Podrás reenviar el email en <strong>{{ countdown }} segundos</strong></p>
            </div>
          }

          @if (countdown === 0) {
            <div class="resend-section">
              <p>¿No recibiste el email?</p>
              <button 
                mat-stroked-button 
                color="primary" 
                (click)="resendEmail()"
                [disabled]="isLoading"
              >
                Reenviar email
              </button>
            </div>
          }

          <div class="form-footer">
            <p><a routerLink="/login" class="link">Volver al inicio de sesión</a></p>
          </div>
        </div>
      }
    </div>
  </div>
</div>